@using Business_Model.Model;
@using Business_Model.Helper;
@using System.Configuration;

@section PageStyle
{
    <link href="~/assets/node_modules/morrisjs/morris.css" rel="stylesheet">
    <link href="~/assets/node_modules/vectormap/jquery-jvectormap-2.0.2.css" rel="stylesheet" />
    @*<link href="~/dist/css/pages/easy-pie-chart.css" rel="stylesheet">*@
    <link href="~/assets/node_modules/toast-master/css/jquery.toast.css" rel="stylesheet">
    <link href="/dist/css/pages/pricing-page.css" rel="stylesheet">
    <link href="/BuildMyUnicornClient/Content/app_css/toastr.min.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
}
@{

    String refID = Encryption.EncryptGuid(Convert.ToString(ViewBag.obj.LinkID));
    String url = ConfigurationManager.AppSettings["ClientBaseUrl"] + "/Register?refid=" + refID;
    int Counter = 0;
    // string url = HttpContext.Current.Request.Url.AbsoluteUri.Replace(HttpContext.Current.Request.Url.PathAndQuery, VirtualPathUtility.ToAbsolute("~/")+"Register?refid=" + refID);
}
<div class="row page-titles">
    <div class="col-md-5 align-self-center">
        <h4 class="text-themecolor">Dashboard</h4>
    </div>

</div>
<input type="hidden" id="JsonCustomer" name="JsonCustomer" value='@Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(ViewBag.CustomerList))' />
<div class="row">
    <div class="col-lg-6">
        <div class="row">
            <!-- column -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">ACTIVE CLIENTS</h5>
                        <div class="d-flex m-t-30 m-b-20 no-block align-items-center">
                            <span class="display-5 text-info"><i class="icon-people"></i></span>
                            <a href="javscript:void(0)" class="link display-5 ml-auto">@ViewBag.obj.ClientNumber</a>
                        </div>
                    </div>
                </div>
            </div>
            <!-- column -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">TOTAL CLIENTS</h5>
                        <div class="d-flex m-t-30 m-b-20 no-block align-items-center">
                            <span class="display-5 text-purple"><i class="icon-folder"></i></span>
                            <a href="javscript:void(0)" class="link display-5 ml-auto">@ViewBag.obj.ClientNumber</a>
                        </div>
                    </div>
                </div>
            </div>
            <!-- column -->
            <div class="col-md-12">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">AFFILATE LINK</h5>
                        <div class="d-flex m-t-30 m-b-20 no-block align-items-center">
                            <span class="display-5 text-primary"><i class="icon-folder-alt"></i></span>
                            <input type="hidden" id="jsAffiliatelink" value="@url">
                            <a href="javscript:void(0)" class="link display-5 ml-auto" onclick="copyToClipboard('jsAffiliatelink')" style="font-size:12px;padding-left:8px">@url</a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- column -->
        </div>
    </div>
    <div class="col-lg-6">
        <div class="card">
            <div class="card-body">
                <div class="row">
                    <!-- Column -->
                    <div class="col-lg-12">
                        <div class="card">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-12">

                                        <h5 class="card-title">CLIENTS LOCATION</h5>
                                        <div id="visitfromworld" style="width:100%!important; height:250px">

                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Column -->
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>
<div class="row">

    @if (ViewBag.Model != null)
    {

        foreach (var item in ViewBag.Model)
        {
            Counter = Counter + 1;
            <div class="col-md-6">
                <div class="card card-body">
                    <div class="row align-items-center">
                        <div class="col-md-4 col-lg-3 text-center">
                            <a href="app-contact-detail.html"><img src="@ConfigurationManager.AppSettings["AcceleratorBaseUrl"]/Content/Images/@(ViewBag.Accelerator.ImageID == null ? "profile-dummy.png" :  ViewBag.Client.ImageID)" width="90" alt="user" class="img-circle img-fluid"></a>
                        </div>
                        <div class="col-md-8 col-lg-9">
                            <h3 class="box-title m-b-0"> @item.StartupName</h3>
                            @*<h4 class="box-title m-b-0">Name: @item.FirstName @item.LastName</h4> <small>Web Designer</small>*@
                            <address>

                                <br>
                                <br>
                                <abbr title="Phone">P:</abbr>@item.Phone
                            </address>
                        </div>
                        <div class="col-md-12">
                            <h4 class="card-title" style="text-align:center"><a href="~/client?id=@item.ClientID">Progress </a> </h4>


                            <div class="card">
                                <div class="card-body">

                                    <div>
                                        <canvas id="chart@(Counter)" height="150"></canvas>

                                        <input type="hidden" id="chartData@(Counter)" value='@Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(item.ProgressAnalytic))' />
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


        }
    }
</div>


@section PageScript
{
    <script src="~/assets/node_modules/flot/jquery.flot.js"></script>
    <script src="~/assets/node_modules/flot.tooltip/js/jquery.flot.tooltip.min.js"></script>
    <script src="~/assets/node_modules/sparkline/jquery.sparkline.min.js"></script>


    <script src="~/assets/node_modules/vectormap/jquery-jvectormap-2.0.2.min.js"></script>
    <script src="~/assets/node_modules/vectormap/jquery-jvectormap-world-mill-en.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="~/assets/node_modules/toast-master/js/jquery.toast.js"></script>
    <script src="~/Content/app_script/page_script/affiliate.js?version=@DateTime.Now"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>

    <script src="~/assets/node_modules/Chart/Chart.min.js"></script>

    <script>
        function copyToClipboard(element) {

            var copyText = document.getElementById(element);
            copyText.type = 'text';
            copyText.select();
            document.execCommand("copy");
            copyText.type = 'hidden';
            toastMessage("Copy", "success", "Survey link copyied to clipboard");
        }
    </script>
    <script>
 var markerCustomer = [];
var TotalCustomer = 0;
var objCustomer = jQuery.parseJSON($("#JsonCustomer").val());
$.each(objCustomer, function (key, value) {
    TotalCustomer = parseInt(value.Total) + parseInt(TotalCustomer);
    markerCustomer.push(
        {
          latLng: [value.latitude, value.longitude], name: "" + value.CountryName + " : " + value.Total+"", style: { fill: "#20aee3" }
        });

});


$(".jsTotalCustomer").html(TotalCustomer);



$(function () {
    "use strict";
    jQuery("#visitfromworld").vectorMap({
        map: "world_mill_en"
        , backgroundColor: "transparent"
        , borderColor: "#000"
        , borderOpacity: .9
        , borderWidth: 1
        , zoomOnScroll: !1
        , color: "#ddd"
        , regionStyle: {
            initial: {
                fill: "transparent"
                , "stroke-width": 1
                , stroke: "#a6b7bf"
            }
        }
        , markerStyle: {
            initial: {
                r: 5
                , fill: "#26c6da"
                , "fill-opacity": 1
                , stroke: "#fff"
                , "stroke-width": 1
                , "stroke-opacity": 1
            }
        }
        , enableZoom: !0
        , hoverColor: "#79e580"
        , markers: markerCustomer
        , hoverOpacity: null
        , normalizeFunction: "linear"
        , scaleColors: ["#fff", "#ccc"]
        , selectedColor: "#c9dfaf"
        , selectedRegions: []
        , showTooltip: !0
        , onRegionClick: function (e, o, l) {
            var t = 'You clicked "' + l + '" which has the code: ' + o.toUpperCase();
            alert(t)
        }
    });


        // Real Time chart
    var data = []
        , totalPoints = 100;

    function getRandomData() {
        if (data.length > 0) data = data.slice(1);
        // Do a random walk
        while (data.length < totalPoints) {
            var prev = data.length > 0 ? data[data.length - 1] : 50
                , y = prev + Math.random() * 10 - 5;
            if (y < 0) {
                y = 0;
            }
            else if (y > 100) {
                y = 100;
            }
            data.push(y);
        }
        // Zip the generated y values with the x values
        var res = [];
        for (var i = 0; i < data.length; ++i) {
            res.push([i, data[i]])
        }
        return res;
    }
    // Set up the control widget
    var updateInterval = 20;
    $("#updateInterval").val(updateInterval).change(function () {
        var v = $(this).val();
        if (v && !isNaN(+v)) {
            updateInterval = +v;
            if (updateInterval < 1) {
                updateInterval = 1;
            }
            else if (updateInterval > 2000) {
                updateInterval = 2000;
            }
            $(this).val("" + updateInterval);
        }
    });
    var plot = $.plot("#placeholder", [getRandomData()], {
        series: {
            shadowSize: 0 // Drawing is faster without shadows
        }
        , yaxis: {
            min: 0
            , max: 100
        }
        , xaxis: {
            show: false
        }
        , colors: ["#01c0c8"]
        , grid: {
            color: "#AFAFAF"
            , hoverable: true
            , borderWidth: 0
            , backgroundColor: 'transparent'
        }
        , tooltip: true
        , resize: true
        , tooltipOpts: {
            content: "Y: %y"
            , defaultTheme: false
        }
    });

    function update() {
        plot.setData([getRandomData()]);
        // Since the axes don't change, we don't need to call plot.setupGrid()
        plot.draw();
        setTimeout(update, updateInterval);
    }
    update();

    $("body").trigger("resize");
    //This is for the perfect scroll

    $('.slimscrollcountry').perfectScrollbar();
});
//sparkline charts
var sparklineLogin = function () {
    $("#sparkline8").sparkline([2, 4, 4, 6, 8, 5, 6, 4, 8, 6, 6, 2], {
        type: 'line'
        , width: '100%'
        , height: '50'
        , lineColor: '#99d683'
        , fillColor: '#99d683'
        , maxSpotColor: '#99d683'
        , highlightLineColor: 'rgba(0, 0, 0, 0.2)'
        , highlightSpotColor: '#99d683'
    });
    $("#sparkline9").sparkline([0, 2, 8, 6, 8, 5, 6, 4, 8, 6, 6, 2], {
        type: 'line'
        , width: '100%'
        , height: '50'
        , lineColor: '#13dafe'
        , fillColor: '#13dafe'
        , minSpotColor: '#13dafe'
        , maxSpotColor: '#13dafe'
        , highlightLineColor: 'rgba(0, 0, 0, 0.2)'
        , highlightSpotColor: '#13dafe'
    });
    $("#sparkline10").sparkline([2, 4, 4, 6, 8, 5, 6, 4, 8, 6, 6, 2], {
        type: 'line'
        , width: '100%'
        , height: '50'
        , lineColor: '#ffdb4a'
        , fillColor: '#ffdb4a'
        , maxSpotColor: '#ffdb4a'
        , highlightLineColor: 'rgba(0, 0, 0, 0.2)'
        , highlightSpotColor: '#ffdb4a'
    });
}
var sparkResize;
$(window).resize(function (e) {
    clearTimeout(sparkResize);
    sparkResize = setTimeout(sparklineLogin, 500);
});
sparklineLogin();






    </script>
    @if (ViewBag.Model != null)
    {
        Counter = 0;
        foreach (var item in ViewBag.Model)
        {
            Counter = Counter + 1;
            <script>
                var _progressData = [];
                var _progressDate = [];
                var objProgressAnalytic = jQuery.parseJSON($("#chartData@(Counter)").val());
                $.each(objProgressAnalytic, function (key, value) {
                 _progressData.push(value.ProgressData);
                 _progressDate.push(moment(value.ProgressDate).format('DD MMMM'));
                });
            </script>
            <script>
             new Chart(document.getElementById("chart@(Counter)"),
             {
            "type": "line",

                "data": {
                    "labels": _progressDate, // ["1May", "2Jun", "3Apr"],
                    "datasets": [{
                        "label":"Overall Progress",
                        //   "axis": 'y',
                        "fill": false,
                        "data": _progressData,
                        "fill": false,
                        "borderColor": "rgb(75, 192, 192)",
                        "lineTension": 0.1
                    }]
                }, "options": {
                    "indexAxis": 'y'
                }
            });
            </script>
        }
    }

}
